================================================================================
Airtable 403 Forbidden 에러 해결 가이드
================================================================================

403 에러는 "권한 없음" 또는 "접근 거부"를 의미해요.
이 에러가 발생하는 주요 원인과 해결 방법을 안내합니다.

================================================================================
1. 에러 원인 분석
================================================================================

콘솔에 나타난 에러:
"Airtable API 오류: 403, Invalid permissions, or the requested model was not found."

이 에러는 다음 중 하나일 수 있어요:
1. API 키에 쓰기 권한이 없음
2. API 키가 해당 Base에 접근할 수 없음
3. 테이블 이름이 정확하지 않음
4. Base ID가 올바르지 않음

================================================================================
2. 해결 방법
================================================================================

2.1. API 키 권한 확인 및 재발급 (가장 중요!)

1. Airtable 웹사이트에 로그인하세요
2. 우측 상단 계정 아이콘 클릭 → "Account" 선택
3. "Developer" 섹션으로 이동
4. "Personal access tokens" 섹션 확인
5. 기존 토큰을 삭제하고 새로 만드세요:
   - "Create new token" 클릭
   - 토큰 이름 입력 (예: "AX 역량 진단")
   - **중요**: 다음 권한을 모두 선택하세요:
     ✅ data.records:read (읽기 권한)
     ✅ data.records:write (쓰기 권한)
     ✅ schema.bases:read (Base 스키마 읽기 권한)
   - "Create token" 클릭
6. 생성된 새 토큰을 복사하세요
7. config.js 파일의 AIRTABLE_API_KEY에 새 토큰을 입력하세요
8. 파일을 저장하세요 (Ctrl + S)

2.2. Base 접근 권한 확인

1. Airtable에서 Base를 엽니다
2. 우측 상단의 "Share" 버튼을 클릭하세요
3. Base가 공유되어 있는지 확인하세요
4. 본인이 Base의 소유자인지 확인하세요
   - 소유자가 아니면 쓰기 권한이 없을 수 있어요

2.3. 테이블 이름 확인

1. Airtable에서 Base를 엽니다
2. 테이블 이름이 정확히 "사용자_평가결과"인지 확인하세요
   - 대소문자 정확히 일치
   - 공백과 언더스코어 정확히 일치
   - 예: "사용자_평가결과" (O), "사용자 평가결과" (X)

2.4. Base ID 확인

1. 브라우저 주소창에서 Base ID를 다시 확인하세요
2. config.js의 AIRTABLE_BASE_ID와 일치하는지 확인하세요
3. "app"으로 시작하는지 확인하세요

================================================================================
3. 코드 수정 완료 사항
================================================================================

✅ 테이블 이름 URL 인코딩 추가
- 한글 테이블 이름이 URL에 포함될 때 제대로 인코딩되도록 수정했습니다
- getAirtableEndpoint 함수에 encodeURIComponent 추가

이제 테이블 이름이 URL에 올바르게 인코딩되어 전송됩니다.

================================================================================
4. 단계별 해결 체크리스트
================================================================================

□ 1. API 키 재발급 (쓰기 권한 포함)
□ 2. 새 API 키를 config.js에 입력
□ 3. config.js 파일 저장 (Ctrl + S)
□ 4. 브라우저 완전 새로고침 (Ctrl + Shift + R)
□ 5. 테이블 이름이 "사용자_평가결과"인지 확인
□ 6. Base ID가 올바른지 확인
□ 7. 설문을 다시 완료해보기
□ 8. 콘솔에서 에러 메시지 확인

================================================================================
5. 테스트 방법
================================================================================

5.1. 설정 확인
1. config.js 파일을 엽니다
2. API 키와 Base ID가 올바르게 입력되어 있는지 확인합니다
3. 파일을 저장합니다

5.2. 브라우저 새로고침
1. 브라우저에서 페이지를 완전히 새로고침합니다 (Ctrl + Shift + R)
2. 개발자 도구를 엽니다 (F12)
3. Console 탭을 확인합니다

5.3. 설문 완료
1. 설문을 처음부터 완료합니다
2. 역량 진단도 완료합니다
3. 콘솔에서 다음 메시지를 확인합니다:
   - "💾 설문 결과를 Airtable에 저장합니다..."
   - "✅ 설문 결과 저장 완료!" (성공)
   - 또는 에러 메시지 (실패)

5.4. Airtable 확인
1. Airtable 웹사이트를 엽니다
2. "사용자_평가결과" 테이블을 확인합니다
3. 새 레코드가 추가되었는지 확인합니다

================================================================================
6. 여전히 403 에러가 발생하면
================================================================================

6.1. API 키 확인
- API 키가 만료되지 않았는지 확인하세요
- API 키에 쓰기 권한이 있는지 다시 확인하세요
- 새 API 키를 발급받아서 시도해보세요

6.2. Base 소유권 확인
- Base를 본인이 직접 만든 것인지 확인하세요
- 다른 사람이 만든 Base를 공유받은 경우 쓰기 권한이 없을 수 있어요
- 본인이 Base를 만들었는지 확인하세요

6.3. Airtable 계정 확인
- Airtable 계정이 정상적으로 작동하는지 확인하세요
- 다른 Base에서도 같은 문제가 발생하는지 확인하세요

================================================================================
7. 추가 팁
================================================================================

7.1. API 키 보안
- API 키는 절대로 공개하지 마세요
- GitHub 같은 공개 저장소에 올리지 마세요
- .gitignore 파일에 config.js를 추가하세요

7.2. 에러 로그 확인
- 브라우저 콘솔의 Network 탭을 확인하세요
- "airtable.com"으로 시작하는 요청을 찾아보세요
- 요청의 "Headers" 탭에서 Authorization 헤더를 확인하세요
- 요청의 "Response" 탭에서 상세한 에러 메시지를 확인하세요

================================================================================
문서 끝
================================================================================

